<!DOCTYPE html>
<html>
  <head>
    <title>Form Autosave</title>

    <style type="text/css">
      body {
        margin: 1em auto;
        max-width: 40em;
        width: 88%;
      }

      label,
      input,
      textarea {
        display: block;
        width: 100%;
      }

      input,
      textarea {
        margin-bottom: 1em;
      }

      textarea {
        height: 8em;
      }
    </style>
  </head>
  <body>
    <h1>Form Autosave</h1>

    <form id="save-me">
      <label for="name">Name</label>
      <input type="text" name="name" id="name" class="autosave" />

      <label for="address">Address</label>
      <input type="text" id="address" class="autosave" />

      <label for="email">Email</label>
      <input type="email" id="email" class="autosave" />

      <label for="more">Additional thoughts?</label>
      <textarea name="more" id="more" class="autosave"></textarea>

      <p>
        <button type="submit">Submit</button>
      </p>
    </form>

    <script>
      'use strict;';

      let formAutosave = document.querySelector('#save-me');
      formAutosave.addEventListener('submit', (event) => {
        localStorage.removeItem('saved_form_data');
        formAutosave.reset();
      });

      let textFields = formAutosave.querySelectorAll(':scope > .autosave');

      function saveFormData() {
        let savedDataArray = [];
        for (textField of textFields) {
          savedDataArray.push({
            id: textField.id,
            value: textField.value,
          });
        }
        localStorage.setItem('saved_form_data', JSON.stringify(savedDataArray));
        // console.log('Save: ' + localStorage.getItem('saved_form_data'));
      }

      (function loadFormData(data) {
        let savedData = localStorage.getItem(data);
        if (!savedData) return;
        // console.log('Load: ' + savedData);
        let savedDataArray = JSON.parse(savedData);
        // console.log('Parsed: ' + savedDataArray);
        for (let elem of savedDataArray) {
          document.getElementById(elem.id).value = elem.value;
        }
      })('saved_form_data');

      formAutosave.addEventListener('input', saveFormData);
    </script>
  </body>
</html>
